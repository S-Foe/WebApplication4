
<style>
    .noBorder {
        border: 0px;
        width: 100%;
    }
</style>
<script>
    $(document).ready(function () {
        console.log("ready!");
        getUserList();
    });
    function loginUser() {
        var txtEmail = $("#txtEmail").val();
        var txtPassword = $("#txtPassword").val();
        var url = '@Url.Action("userLogin")';
        if (txtEmail == undefined || txtPassword == undefined) {
            alert(undefined);
        } else {
            $.ajax({
                type: "POST",
                url: url,
                data: { strEmail: txtEmail, strPassword: txtPassword },
                dataType: "json",
                success: function (response) {
                    location.reload();
                },
                error: function (xhr, ajaxOptions, thrownError) {
                    alert("error");
                }
            });
        }
    }
    function getUserList() {
        var url = '@Url.Content("~/api/Values")';
        $.ajax({
            type: "GET",
            url: url,
            dataType: "json",
            success: function (response) {
                drowData(response, 'dvUserHolder');
            },
            error: function (xhr, ajaxOptions, thrownError) {
                alert("error");
            }
        });
    }
    function tblRowClicked(id) {
        if (id == undefined || id == '') {
            id = -1;
        }
        $('#hdnObjId').val(id);
        var url = '@Url.Content("~/api/Values")/' + id;
        $.ajax({
            type: "GET",
            url: url,
            dataType: "json",
            success: function (response) {
                appendUserInfo(response);
            },
            error: function (xhr, ajaxOptions, thrownError) {
                alert("error");
            }
        });
    }
    function deleteRowClicked(id) {
        if (id == undefined || id == '') {
            id = -1;
        }
        $('#hdnObjId').val(id);
        var url = '@Url.Content("~/api/Values")/' + id;
        $.ajax({
            type: "DELETE",
            url: url,
            dataType: "json",
            success: function (response) {
                getUserList();
            },
            error: function (xhr, ajaxOptions, thrownError) {
                alert("error");
            }
        });
    }
    function appendUserInfo(userData) {
        $('#txtFirstName').val(userData.FirstName);
        $('#txtLastName').val(userData.LastName);
        $('#_txtEmail').val(userData.EMail);
        $('#txtPhoneNumber').val(userData.PhoneNumber);
        $('#_txtPassword').val(userData.Password);

        $('#userInfoEditor').css('display','block');
    }
    function createUserInfo() {
        $('#hdnObjId').val('-1');
        $('#txtFirstName').val('');
        $('#txtLastName').val('');
        $('#_txtEmail').val('');
        $('#txtPhoneNumber').val('');
        $('#_txtPassword').val('');

        $('#userInfoEditor').css('display', 'block');
    }
    function clearAndClose() {
        $('#hdnObjId').val('-1');
        $('#txtFirstName').val('');
        $('#txtLastName').val('');
        $('#_txtEmail').val('');
        $('#txtPhoneNumber').val('');
        $('#_txtPassword').val('');

        $('#userInfoEditor').css('display', 'none');
    }
    function drowData(data, dvholder) {
        var strHtml = '<table class=" table table-bordered table-responsive table-striped table-hover table-condensed">';
        strHtml += '<tr><td></td><td>Name</td><td>Email</td><td>Phone Number</td><td>Joined Date</td><td></td></tr>';
        $.each(data, function (i, item) {
            strHtml += '<tr>';
            fonClick = 'onclick="tblRowClicked(' + item.Id + ')"';
            fDelClick = 'onclick="deleteRowClicked(' + item.Id + ')"';
            strHtml += '<td> <div class="mr-auto"><div class=""><input type="checkbox" class="trayCheckbox" onclick="trayCheckbox(' + item.Id + ');" name="transactionCheck" value=' + item.Id + '></div></div> </td>';
            strHtml += '<td ' + fonClick +'> ' + item.FirstName + ' ' + item.LastName + ' </td>';
            strHtml += '<td ' + fonClick +'> ' + item.EMail + ' </td>';
            strHtml += '<td ' + fonClick + '> ' + item.PhoneNumber + ' </td>';
            strHtml += '<td ' + fonClick + '> ' + (item.CreatedDate).substring(0, 10) + ' </td>';

            strHtml += '<td ' + fDelClick +'> <div class="btn btn-danger"> Delete </div> </td>';

            strHtml += '</tr>';
        });
        strHtml += '</table>';

        $('#' + dvholder).html(strHtml);
    }
    function trayCheckbox(objId) {
        //var newValue = $('#hdnObjListIds').val() + objId + '_';

        var selectedTrans = '';
        var tabArr = $('.trayCheckbox');
        for (var i = 0; i < tabArr.length; i++) {
            if (tabArr[i].checked) {
                selectedTrans = selectedTrans + tabArr[i].value + ',';
            }
        }
        $('#hdnObjListIds').val(selectedTrans);
    }
    //function updateUserInfo() {
    //    $('#userInfoEditor').css('display', 'block');
    //}
    function sendEmail() {
        var vids = $('#hdnObjListIds').val();
        var vtxtSubject = $('#txtSubject').val();
        var vtxtBody = $('#txtBody').val();


        var url = '@Url.Action("sendEmailClick")';
        if (vids == undefined || vtxtSubject == undefined || vtxtBody == undefined
            ||
            vids == '' || vtxtSubject == '' || vtxtBody == '') {
            alert(undefined);
        } else {
            $.ajax({
                type: "POST",
                url: url,
                data: { Ids: vids, txtSubject: vtxtSubject, txtBody: vtxtBody },
                dataType: "json",
                success: function (response) {
                    debugger;
                    console.log('email sent');
                },
                error: function (xhr, ajaxOptions, thrownError) {
                    alert("error");
                }
            });
        }
    }
    function updateUserInfo() {
        var vid = $('#hdnObjId').val();
        var vFirstName = $('#txtFirstName').val();
        var vLastName = $('#txtLastName').val();
        var vEMail = $('#_txtEmail').val();
        var vPhoneNumber = $('#txtPhoneNumber').val();
        var vPassword = $('#_txtPassword').val();
        var sObject = { Id: vid,FirstName: vFirstName, LastName: vLastName, EMail: vEMail, PhoneNumber: vPhoneNumber, Password: vPassword };

        var url = '@Url.Content("~/api/Values")';
        $.ajax({
            type: "POST",
            url: url,
            data: JSON.stringify(sObject),
            processData: false,
            contentType: "application/json; charset=UTF-8",
            dataType: "json",
            success: function (response) {
                getUserList();
            },
            error: function (xhr, ajaxOptions, thrownError) {
                alert("error");
            }
        });
    }

</script>

<br />
@{ if (Session["UserProfile"] == null)
    {
        <div class="jumbotron">
            <div class="row body-content ">
                <div class="col-md-4">
                    <h4>Email : </h4>
                    <div class="form-control">
                        <input type="email" id="txtEmail" class="input-group noBorder" />
                    </div>
                    <h4>Password : </h4>
                    <div class="form-control">
                        <input type="password" id="txtPassword" class="input-group noBorder" />
                    </div>
                    <br />
                    <div class="">
                        <input type="button" value="Login" class="btn btn-primary" onclick="loginUser();" />
                    </div>
                    <br />
                </div>
            </div>
        </div>
    }
}


<div class="col-md-4">

    <div class="">
        <input type="button" value="Create new" class="btn btn-primary" onclick="createUserInfo();" />
    </div>
    <br />
</div>
<br />
<div id="dvUserHolder"></div>

<br />
<br />
<div class="jumbotron" id="userInfoEditor" style="display:none;">
    <div class="row body-content ">
        <div class="col-md-4">
            <h4>First Name : </h4>
            <div class="form-control">
                <input type="text" id="txtFirstName" class="input-group noBorder" />
            </div>
        </div>
        <div class="col-md-4">
            <h4>Last Name : </h4>
            <div class="form-control">
                <input type="text" id="txtLastName" class="input-group noBorder" />
            </div>
        </div>
        <div class="col-md-4">
            <h4>Email : </h4>
            <div class="form-control">
                <input type="email" id="_txtEmail" class="input-group noBorder" />
            </div>
        </div>
        <div class="col-md-4">
            <h4>Phone Number : </h4>
            <div class="form-control">
                <input type="number" id="txtPhoneNumber" class="input-group noBorder" />
            </div>
        </div>

        <div class="col-md-4">
            <h4>Password : </h4>
            <div class="form-control">
                <input type="password" id="_txtPassword" class="input-group noBorder" />
            </div>
        </div>
        <div class="col-md-4">
            <br /><br />
            <div class="">
                <input type="button" value="Save" class="btn btn-primary" onclick="updateUserInfo();" />
                <input type="button" value="Cancle" class="btn btn-warning" onclick="clearAndClose();" />
            </div>
        </div>
        <br />

    </div>
</div>
<br />
<div class="row">
    <div class="col-md-4">
        <h2>Email : </h2>

        <div class="">
            <h4>Subject : </h4>
            <div class="form-control">
                <input type="text" id="txtSubject" class="input-group noBorder" />
            </div>
        </div>
    </div>
    <div class="col-md-12">
        <div class="">
            <h4>Body : </h4>
            <div class="">
                <textarea id="txtBody" class="input-group form-control" cols="100" rows="5"></textarea>
            </div>
        </div>
    </div>
    <div class="col-md-12">
        <div class="col-md-12">
            <br /><br />
            <div class="">
                <input type="button" value="Send" class="btn btn-primary" onclick="sendEmail();" />
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-md-4">
        <h2>Getting started</h2>
        <p>
            ASP.NET Web API is a framework that makes it easy to build HTTP services that reach
            a broad range of clients, including browsers and mobile devices. ASP.NET Web API
            is an ideal platform for building RESTful applications on the .NET Framework.
        </p>
        <p><a class="btn btn-default" href="https://go.microsoft.com/fwlink/?LinkId=301870">Learn more &raquo;</a></p>
    </div>
    <div class="col-md-4 ">
        <h2>Get more libraries</h2>
        <p>NuGet is a free Visual Studio extension that makes it easy to add, remove, and update libraries and tools in Visual Studio projects.</p>
        <p><a class="btn btn-default" href="https://go.microsoft.com/fwlink/?LinkId=301871">Learn more &raquo;</a></p>
    </div>
    <div class="col-md-4">
        <h2>Web Hosting</h2>
        <p>You can easily find a web hosting company that offers the right mix of features and price for your applications.</p>
        <p><a class="btn btn-default" href="https://go.microsoft.com/fwlink/?LinkId=301872">Learn more &raquo;</a></p>
    </div>
</div>
<input type="hidden" id="hdnObjId" />
<input type="hidden" id="hdnObjListIds" />